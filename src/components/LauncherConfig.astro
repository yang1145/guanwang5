---
import { Launcher, LauncherList, LauncherItem, LauncherGroup } from 'accessible-astro-launcher'
import { Icon } from 'astro-icon/components'
import themeConfig from '@theme-config'

/**
 * Launcher preferences for accessibility and theme.
 * @type {Array<{ label: string, onAction: string }>}
 */
const launcherPreferenceItems = [
  {
    label: '深色模式',
    onAction: 'toggle-dark-mode',
  },
  {
    label: '高对比度',
    onAction: 'toggle-high-contrast',
  },
  {
    label: '减少动效',
    onAction: 'toggle-reduced-motion',
  },
]

/**
 * Maximum number of blog posts to show in the launcher.
 * @type {number}
 */
const maxLauncherBlogPosts = 30

/**
 * Blog items for the launcher - 客户端渲染，初始为空
 *
 * @type {Array<{ label: string, href: string }>}
 */
const launcherBlogItems: Array<{ label: string; href: string }> = []

/**
 * Project items for the launcher - 客户端渲染，初始为空
 *
 * @type {Array<{ label: string, href: string, keywords: Array<string> }>}
 */
const launcherProjectItems: Array<{ label: string; href: string; keywords: Array<string> }> = []

/**
 * Navigation items for the launcher, built from `themeConfig.navigation.items`.
 * Flattens dropdowns and applies external flags.
 *
 * @type {Array<{ label: string, href: string, external?: boolean }>}
 */
const launcherNavigationItems = themeConfig.navigation.items.flatMap((item) => {
  if (item.excludeFromLauncher) {
    return []
  }

  if (item.type === 'dropdown') {
    return item.items.map((subItem) => ({
      label: subItem.label,
      href: subItem.href,
      external: subItem.external ?? false,
    }))
  }

  if (!item.type || item.type === 'link') {
    return [
      {
        label: item.label,
        href: item.href,
        external: item.external ?? false,
      },
    ]
  }

  return []
})

/**
 * Social items for the launcher, from `themeConfig.socials`.
 *
 * @type {Array<{ label: string, href: string, icon: string, external?: boolean }>}
 */
const launcherSocialItems = (themeConfig.socials ?? []).map((item) => ({
  label: item.label,
  href: item.href,
  icon: item.icon,
  external: item.external ?? false,
}))

const launcherResources = [
  {
    label: 'Astro 官方网站',
    href: 'https://astro.build/',
  },
  {
    label: 'WCAG 无障碍标准',
    href: 'https://www.w3.org/WAI/standards-guidelines/wcag/',
  },
  {
    label: 'ARIA 创作实践指南（APG）',
    href: 'https://www.w3.org/WAI/ARIA/apg/',
  },
  {
    label: 'WebAIM 对比度检测',
    href: 'https://webaim.org/resources/contrastchecker/',
  },
  {
    label: '无障碍测试工具：axe DevTools',
    href: 'https://www.deque.com/axe/devtools/',
  },
]
---

<Launcher id="site-launcher">
  <LauncherList>
    <LauncherGroup label="偏好设置">
      {
        launcherPreferenceItems.map((item) => (
          <LauncherItem type="action" label={item.label} onAction={item.onAction} />
        ))
      }
    </LauncherGroup>
    <LauncherGroup label="页面导航">
      {
        launcherNavigationItems.map((item) => (
          <LauncherItem
            type="navigation"
            label={item.label}
            href={item.href}
            {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          />
        ))
      }
    </LauncherGroup>
    {
      launcherBlogItems.length > 0 && (
        <LauncherGroup label="资讯文章">
          {launcherBlogItems.map((item) => (
            <LauncherItem type="navigation" label={item.label} href={item.href}>
              <Icon slot="icon" aria-hidden="true" name="lucide:scroll-text" size="16" />
            </LauncherItem>
          ))}
        </LauncherGroup>
      )
    }
    {
      launcherProjectItems.length > 0 && (
        <LauncherGroup label="案例">
          {launcherProjectItems.map((item) => (
            <LauncherItem type="navigation" label={item.label} href={item.href} keywords={item.keywords}>
              <Icon slot="icon" aria-hidden="true" name="lucide:bookmark" size="16" />
            </LauncherItem>
          ))}
        </LauncherGroup>
      )
    }
    {
      launcherResources.length > 0 && (
        <LauncherGroup label="资源中心">
          {launcherResources.map((item) => (
            <LauncherItem type="navigation" label={item.label} href={item.href}>
              <Icon slot="icon" aria-hidden="true" name="lucide:external-link" size="16" />
            </LauncherItem>
          ))}
        </LauncherGroup>
      )
    }
    {
      launcherSocialItems.length > 0 && (
        <LauncherGroup label="社交与联系">
          {launcherSocialItems.map((item) => (
            <LauncherItem
              type="navigation"
              label={item.label}
              href={item.href}
              {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
            >
              <Icon slot="icon" aria-hidden="true" name={item.icon} size="16" />
            </LauncherItem>
          ))}
        </LauncherGroup>
      )
    }
  </LauncherList>
</Launcher>
