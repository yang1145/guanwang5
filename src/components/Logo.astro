---
import { Link } from 'accessible-astro-components'
import { Image } from 'astro:assets'
import themeConfig from '@theme-config'

/**
 * Logo Component
 *
 * @description Logo component with dynamic site name from API
 */
interface Props {
  /**
   * Whether to load the image eagerly or lazily
   * @default 'eager'
   */
  loading?: 'eager' | 'lazy'
}

const { loading = 'eager' }: Props = Astro.props
---

<Link href="/" class="flex items-center gap-2">
  {
    themeConfig.logo && (
      <Image
        src={themeConfig.logo}
        alt=""
        aria-hidden="true"
        width="47"
        height="37"
        loading={loading}
      />
    )
  }
  <span id="site-name" class="text-sm font-bold sm:text-lg">{themeConfig.name}</span>
</Link>

<script>
  import { getSiteConfig } from '@utils/clientApi'

  async function loadSiteName() {
    try {
      const response = await getSiteConfig()
      const config = response.data

      // 更新网站名称
      const siteNameEl = document.getElementById('site-name')
      if (siteNameEl && config.company_name) {
        siteNameEl.textContent = config.company_name
      }
    } catch (error) {
      console.error('Failed to load site name:', error)
      // 失败时使用默认值
    }
  }

  // 页面加载完成后获取配置
  loadSiteName()
  
  // 监听页面切换事件（Astro transitions）
  document.addEventListener('astro:page-load', loadSiteName)
</script>
